<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oti.team2.srresource.dao.ISrResourceDao">
	<resultMap type="srResource" id="srResourceResultMap">
		<id property="srSrc" column="SR_SRC"/>
		<result property="empId" column="EMP_ID"/>
		<result property="empNm" column="FLNM"/>
		<result property="ptcptnRoleNm" column="ROLE_NM"/>
		<result property="ptcptnRoleCd" column="PTCPTN_ROLE_CD"/>
		<result property="schdlBgngYmd" column="SCHDL_BGNG_YMD"/>
		<result property="schdlEndYmd" column="SCHDL_END_YMD"/>
	</resultMap>
	<!-- 자원정보 리스트 가져오기 -->
	<select id="selectBySrNo" parameterType="String" resultMap="srResourceResultMap">
		SELECT 
			SR_SRC ,
			EMP_ID,
			FLNM ,
			ROLE_NM ,
			PTCPTN_ROLE_CD,
			SCHDL_BGNG_YMD ,
			SCHDL_END_YMD 
		FROM
			SR_RESOURCES s, MEMBERS m, ROLE r
		WHERE
			s.EMP_ID = m.MEMBER_ID AND
			s.PTCPTN_ROLE_CD=r.ROLE_CD AND
			SR_NO=#{srNo}
	</select>
	<!-- 일정 정보 가져오기 -->
	<select id="selectByEmpId" parameterType="String" resultType="srResourceOfDeveloper">
		SELECT 
			SR_SRC as "srSrc",
			TTL as "title",
			SCHDL_BGNG_YMD as "start",
			SCHDL_END_YMD as "end"
		FROM
			SR_RESOURCES r, SR_INFORMATION i, SR_DEMAND d
		WHERE
			r.SR_NO=i.SR_NO AND
			i.DMND_NO = d.DMND_NO AND
			r.EMP_ID=#{empId}
	</select>
	
	<!-- 자원정보 추가 -->
	<insert id="insertSrResource" parameterType="srResource" >
		INSERT INTO SR_RESOURCES (SR_SRC, SR_NO, EMP_ID, PTCPTN_ROLE_CD, SCHDL_BGNG_YMD, SCHDL_END_YMD)
		VALUES (sr_src_seq.nextval,#{srNo}, #{empId}, #{ptcptnRoleCd}, #{schdlBgngYmd}, #{schdlEndYmd})  
		
	</insert>
	
	<!-- 자원정보 삭제 -->
	<delete id="deleteBySrSrc" parameterType="java.util.List">
		DELETE FROM SR_RESOURCES
		<where>
			<foreach item="src" collection="srSrc" separator="OR" open="(" close=")">
				SR_SRC = #{src}
			</foreach>
		</where>
	</delete>
	
	<!-- 자원정보 수정 -->
	<update id="updateSrResource" parameterType="srResource" >
		UPDATE SR_RESOURCES
			<trim prefix="SET" suffixOverrides=",">
				<if test="ptcptnRoleCd != null">
					PTCPTN_ROLE_CD = #{ptcptnRoleCd},
				</if>
				<if test="schdlBgngYmd != null">
					SCHDL_BGNG_YMD = #{schdlBgngYmd},
				</if>
				<if test="schdlEndYmd != null">
					SCHDL_END_YMD = #{schdlEndYmd},
				</if>
			</trim>
		WHERE SR_SRC = #{srSrc}
	</update>
</mapper>