<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oti.team2.member.dao.IMemberDao">
	
	<select id="countByMemberType" parameterType="string"
      resultType="int">
          <![CDATA[
             SELECT COUNT(MEMBER_ID)
             FROM MEMBERS
             WHERE MEMBER_TYPE = #{memberType}
          ]]>
   </select>
	<!-- 
	 * 작성자: 안한길
	 * 작성일: 2023.02.20.
	 * 내용: 사원 rud
	 -->
	 <!-- 고객/사원 목록 조회 -->
   <select id="selectByMemberType" parameterType="map"
      resultMap="memberResult">  
         SELECT 
            RNUM,
            MEMBER_ID ,
            FLNM ,
            TELNO ,
            EML 
            <if test="memberType == 'CLIENT'">
              ,INST_NM 
            </if>
            <if test="memberType=='DEVELOPER'">
               ,
               JBGD_NM ,
               DEPT_NM 
            </if>
         FROM
            (
               SELECT 
                  ROWNUM as RNUM,
                  MEMBER_ID ,
                  FLNM ,
                  TELNO ,
                  EML 
                  <if test="memberType == 'CLIENT'">
                     , INST_NM
                  </if>
                  <if test="memberType=='DEVELOPER'">
                     ,
                     JBGD_NM ,
                     DEPT_NM 
                  </if>
                   
               FROM
               (
                  SELECT 
                     MEMBER_ID ,
                     FLNM ,
                     ADDR ,
                     TELNO ,
                     EML 
                    <if test="memberType == 'CLIENT'">
                       , i.INST_NM
                    </if>
                    <if test="memberType=='DEVELOPER'">
                       ,
                       JBGD_NM ,
                       DEPT_NM 
                    </if>
                    
                  FROM
                     MEMBERS m
                     <if test="memberType == 'CLIENT'">
                         INNER JOIN INSTITUTION i on m.INST_CD = i.INST_CD 
                     </if>
                     <if test="memberType=='DEVELOPER'">
                           , DEPARTMENTS d, JOB_GRADE j
                     </if>
                  
                  WHERE
                     <if test="memberType=='DEVELOPER'">
                        m.DEPT_CD = d.DEPT_CD and
                        m.JBGD_CD = j.JBGD_CD and
                     </if>                   
                     MEMBER_TYPE = #{memberType}
               )
                <![CDATA[
               WHERE ROWNUM <=#{pager.endRowNo}             
            )       
         WHERE
            RNUM >= #{pager.startRowNo} 
      ]]>
    </select>
	<!-- 맴버상세조회 -->
	<select id="selectByMemberIdAndBymemberType" parameterType="map" resultMap="memberResult">
		SELECT 
			MEMBER_ID ,
			PSWD ,
			FLNM ,
			ADDR ,
			TELNO ,
			EML ,
			m.INST_CD ,
			m.JBGD_CD ,
			m.DEPT_CD ,
			MEMBER_TYPE ,
			FILE_TYPE ,
			FILE_DATA 
		 	<if test="memberType == 'CLIENT'">
               	, i.INST_NM
            </if>
            <if test="memberType=='DEVELOPER'">
               	,
               	JBGD_NM ,
               	DEPT_NM 
            </if>
		FROM
			MEMBERS	m
            <if test="memberType == 'CLIENT'">
                INNER JOIN INSTITUTION i on m.INST_CD = i.INST_CD 
            </if>
            <if test="memberType=='DEVELOPER'">
            	, DEPARTMENTS d, JOB_GRADE j
            </if>
		WHERE 
			<if test="memberType=='DEVELOPER'">
                m.DEPT_CD = d.DEPT_CD and
                m.JBGD_CD = j.JBGD_CD and
            </if>  
			MEMBER_ID = #{memberId}
	</select>
	<!-- 사원삭제 -->
	<delete id="deleteDeveloperByMemberId" parameterType="String">
		DELETE FROM MEMBERS
		WHERE MEMBER_ID=#{memberId}
	</delete>
	<!-- 사원수정 -->
	<update id="updateDeveloperByMemberId" parameterType="member" >
		UPDATE MEMBERS
		SET 
			PSWD = #{pswd},
			FLNM = #{flnm},
			ADDR = #{addr},
			TELNO = #{telno},
			EML = #{eml},
			JBGD_CD = #{jbgdCd},
			DEPT_CD = #{deptCd}
		WHERE
			MEMBER_ID = #{memberId}
	</update>
	<resultMap type="member" id="memberResult">
		<id property="memberId" column="member_id"/>
		<id property="pswd" column="pswd"/>
		<id property="flnm" column="flnm"/>
		<id property="addr" column="addr"/>
		<id property="telNo" column="telno"/>
		<id property="eml" column="eml"/>
		<id property="instCd" column="inst_cd"/>
		<id property="jbgdCd" column="jbgd_cd"/>
		<id property="deptCd" column="dept_cd"/>
		<id property="memberType" column="member_type"/>
		<id property="fileType" column="file_type"/>
		<id property="fileData" column="file_data"/>
		<association property="jobGrade" javaType="jobGrade">
			<result property="jbgdNm" column="jbgd_nm"/>
		</association>
		<association property="department" javaType="department">
			<result property="deptNm" column="dept_nm"/>
		</association>
	</resultMap>
</mapper>